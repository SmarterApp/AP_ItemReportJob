package org.opentestsystem.ap.irj.model;

import lombok.Getter;
import org.opentestsystem.ap.common.model.Table;
import org.opentestsystem.ap.common.model.TiItem;
import org.opentestsystem.ap.common.model.TiItemCore;
import org.opentestsystem.ap.common.model.ValidationResult;
import org.opentestsystem.ap.irj.util.ReportUtil;

import java.util.List;

import static java.lang.String.valueOf;
import static org.apache.commons.lang3.StringUtils.EMPTY;

public class TiItemReport extends AbstractAssessmentItemReport<TiItem> {

    final Table table;

    public TiItemReport(final TiItem item, final String reportStatus, final List<ValidationResult> validationResults) {
        super(item, reportStatus, validationResults);
        table = item.getCore().getEn().getTable();
    }

    @Override
    public String getTiTableColumnCount() {
        return table != null ? valueOf(table.getColumns().size()) : EMPTY;
    }

    @Override
    public String getTiTableRowCount() {
        return table != null ? valueOf(table.getRows().size()) : EMPTY;
    }

    @Override
    public String getTiAnswerCount() {
        return valueOf(ReportUtil.countAnswerCells(table));
    }

    @Override
    public String getItemContent() {
        final TiItemCore core = getItem().getCore();
        final Content content = new Content(core.getEn().getPrompt(), core.getEn().getTable());
        return ReportUtil.toJsonString(content);
    }

    @Getter
    private static class Content {

        private final String prompt;

        private final Table table;

        private Content(String prompt, Table table) {
            this.prompt = prompt;
            this.table = table;
        }
    }
}
